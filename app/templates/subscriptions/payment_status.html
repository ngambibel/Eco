{% extends "base.html" %}
{% load static %}

{% block title %}Statut Paiement - EcoCity{% endblock %}

{% block content %}
<style>
    .status-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
    }
    .status-card {
        background: white;
        border-radius: 15px;
        padding: 0px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        text-align: center;
    }
    .status-icon {
        font-size: 4rem;
        margin-bottom: 20px;
    }
    .status-pending { color: #ffc107; }
    .status-processing { color: #17a2b8; }
    .status-completed { color: #28a745; }
    .status-cancelled { color: #dc3545; }
    .detail-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin: 25px 0;
        text-align: left;
    }
    .detail-item {
        padding: 10px;
        background: #f8f9fa;
        border-radius: 5px;
    }
</style>

<div class="status-container">
    <div class="form-header" style="text-align: center; margin-bottom: 10px;">
        <a href="{% url 'subscriptions_dashboard_reabonnement' %}" 
           style="color: var(--orange-cosmique); text-decoration: none; display: inline-flex; align-items: center; margin-bottom: 20px;">
            <i class="fas fa-arrow-left" style="margin-right: 8px;"></i>
            Retour aux abonnements
        </a>
        <h1 style="color: var(--orange-cosmique); margin-bottom: 0px;">Statut du Paiement</h1>
    </div>

    <div class="status-card">
        <div class="status-icon 
            {% if demande.statut == 'EN_COURS' %}status-processing
            {% elif demande.statut == 'COMPLETEE' %}status-completed
            {% elif demande.statut == 'ANNULEE' %}status-cancelled
            {% else %}status-pending{% endif %}">
            <i class="fas 
                {% if demande.statut == 'EN_COURS' %}fa-sync-alt fa-spin
                {% elif demande.statut == 'COMPLETEE' %}fa-check-circle
                {% elif demande.statut == 'ANNULEE' %}fa-times-circle
                {% else %}fa-clock{% endif %}">
            </i>
        </div>
        
        <h2 style="color: var(--noir); margin-bottom: 0px;">
            {{ demande.get_statut_display }}
        </h2>
        
        <p style="color: var(--gris-fonce); margin-bottom: 10px;">
            {% if demande.statut == 'COMPLETEE' %}
            Votre paiement a été traité avec succès !
            vous serez bientôt réabonné à votre service canal+
            {% elif demande.statut == 'ANNULEE' %}
            Le paiement a échoué. Veuillez réessayer.
            {% else %}
            Votre paiement est en cours de traitement.
            {% endif %}
        </p>

        <div class="detail-grid">
            <div class="detail-item">
                <strong>Service:</strong><br>
                {{ demande.abonnement.get_type_service_display }}
            </div>
            <div class="detail-item">
                <strong>Identifiant:</strong><br>
                {{ demande.abonnement.identifiant_abonne }}
            </div>
            <div class="detail-item">
                <strong>Montant:</strong><br>
                {{ demande.montant }} FCFA
            </div>
            <div class="detail-item">
                <strong>Date:</strong><br>
                {{ demande.date_demande|date:"d/m/Y H:i" }}
            </div>
            {% if demande.reference_paiement %}
            <div class="detail-item" style="grid-column: 1 / -1;">
                <strong>Référence:</strong><br>
                {{ demande.reference_paiement }}
            </div>
            {% endif %}
        </div>

        <div id="actionButtons" style="margin-top: 25px;">
            {% if demande.statut == 'ANNULEE' %}
            <a href="{% url 'process_payment' request_id=demande.id %}" class="btn btn-primary"
               style="background: var(--orange-cosmique); color: white; padding: 12px 25px; border-radius: 25px; text-decoration: none; display: inline-block; margin: 0 5px;">
                <i class="fas fa-redo"></i> Réessayer le Paiement
            </a>
            {% endif %}
            
            <a href="{% url 'subscriptions_dashboard_reabonnement' %}" class="btn btn-secondary"
               style="background: var(--gris-clair); color: var(--gris-fonce); padding: 12px 25px; border-radius: 25px; text-decoration: none; display: inline-block; margin: 0 5px;">
                <i class="fas fa-list"></i> Mes Abonnements
            </a>
        </div>
    </div>
</div>
{% endblock %}